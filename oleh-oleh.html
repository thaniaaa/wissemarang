<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <title>Cyborg - Awesome HTML5 Template</title>

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">


    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-cyborg-gaming.css">
    <link rel="stylesheet" href="assets/css/owl.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet"href="https://unpkg.com/swiper@7/swiper-bundle.min.css"/>

    <style>

      .favorite-icon {
          position: absolute;
          top: 10px;
          right: 10px;
          font-size: 24px;
          color: red;
          cursor: pointer;
          transition: 0.3s;
          background: #d2d2d2;
          border-radius: 50%;
          padding: 5px;
      }

      .favorite-icon:hover {
          color: darkred;
      }
  </style>

  </head>

<body>

  <!-- ***** Preloader Start ***** -->
  <div id="js-preloader" class="js-preloader">
    <div class="preloader-inner">
      <span class="dot"></span>
      <div class="dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>
  <!-- ***** Preloader End ***** -->

  <!-- ***** Header Area Start ***** -->
  <header class="header-area header-sticky">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <nav class="main-nav">
                    <!-- ***** Logo Start ***** -->
                    <a href="index.html" class="logo">
                        <img src="assets/images/logo.png" alt="">
                    </a>
                    <!-- ***** Logo End ***** -->
                     <!-- ***** Menu Start ***** -->
                     <ul class="nav">
                        <li><a href="index.html" class="active">Home</a></li>
                        <li><a href="index.html#kategori-wisata">Kategori</a></li>
                        <li><a href="index.html#tempat-populer">Populer</a></li>
                        <li><a href="favorite.html">Favorite</a></li> 
                        <li><a href="profile.html">Profile</a></li>
                    </ul>   
                    <a class='menu-trigger'>
                        <span>Menu</span>
                    </a>
                    <!-- ***** Menu End ***** -->
                </nav>
            </div>
        </div>
    </div>
  </header>
  <!-- ***** Header Area End ***** -->

  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="page-content">

          <!-- ***** Featured Games Start ***** -->
          <div class="row">
            <div class="col-lg-8">
              <div class="featured-games header-text">
                <div class="heading-section">
                  <h4><em>Oleh-oleh</em> Khas Semarang</h4>
                </div>
                <div class="owl-carousel owl-theme" id="oleh-oleh-carousel">
                  <!-- Tempat populer akan diisi dari JavaScript -->
              </div>
            </div>
          </div>
            
          <div class="col-lg-4">
            <div class="top-streamers">
                <div class="heading-section">
                    <h4><em>Fakta</em> Semarang</h4>
                </div>
                <img src="wisata-backend\wisataImage\lawangsewu.jpg" alt="Kota Semarang" class="img-fluid rounded mb-3">
                <p>Siapa yang tidak kenal Lawang Sewu? Bangunan peninggalan Belanda ini terkenal dengan jumlah pintu dan jendela yang sangat banyak—walaupun sebenarnya jumlahnya tidak sampai seribu. 
                  Dahulu, Lawang Sewu berfungsi sebagai kantor pusat perusahaan kereta api kolonial (NIS).</p>
            </div>
        </div>
          <!-- ***** Featured Games End ***** -->

                <!-- List Kota Lama -->
                <div class="live-stream">
                  <div class="col-lg-12">
                    <div class="heading-section">
                      <h4><em>Oleh-Oleh </em> di Kota Semarang</h4>
                    </div>
                  </div>
                  <div class="row" id="oleh-oleh-list">
                      <!-- Data akan dimasukkan melalui JavaScript -->
                  </div>
                </div>
                <!-- ***** Live Stream End ***** -->

              </div>
            </div>
          </div>
        </div>
        <div class="container mt-4">
          <h2>Oleh-Oleh Populer</h2>
          <div id="oleh-oleh-list" class="row"></div>  <!-- Data kota lama akan dimasukkan di sini -->
      </div>
  
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <p>Pemerintah Kota Semarang ©2025. <a href="#"> All Rights Reserved. </a> Created by <span class="blue-text">Diskominfo Kota Semarang</span>.</p>

          
          <!-- <br>Design: <a href="https://templatemo.com" target="_blank" title="free CSS templates">TemplateMo</a></p> -->
        </div>
      </div>
    </div>
  </footer>


  <!-- Scripts -->
  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

  <script src="assets/js/isotope.min.js"></script>
  <script src="assets/js/owl-carousel.js"></script>
  <script src="assets/js/tabs.js"></script>
  <script src="assets/js/popup.js"></script>
  <script src="assets/js/custom.js"></script>

  <script>
document.addEventListener("DOMContentLoaded", function () {
            fetch("http://localhost:5000/api/wisata/kategori/Oleh-Oleh")
                .then(response => response.json())
                .then(data => {
                    if (!Array.isArray(data)) {
                        console.error("Data tidak valid:", data);
                        return;
                    }

                    // Sorting berdasarkan rating tertinggi
                     data.sort((a, b) => b.rating - a.rating);

                    // Tampilkan oleh-oleh populer di carousel
                    const olehOlehCarousel = document.getElementById("oleh-oleh-carousel");
                    olehOlehCarousel.innerHTML = "";
                    
                    data.slice(0, 5).forEach(wisata => { // Hanya ambil 5 oleh-oleh untuk carousel
                        const item = document.createElement("div");
                        item.classList.add("item");

                        item.innerHTML = `
                            <div class="thumb">
                                <img src="http://localhost:5000/${wisata.foto}" alt="${wisata.nama_tempat}">
                            </div>
                            <h4>${wisata.nama_tempat}</h4>
                            <p><strong>Rating:</strong> ${wisata.rating ? wisata.rating : 'Tidak ada rating'} ⭐</p>
                        `;



                        olehOlehCarousel.appendChild(item);
                    });

                    $("#oleh-oleh-carousel").owlCarousel({
                        items: 3,
                        loop: true,
                        autoplay: true,
                        autoplayTimeout: 3000,
                        dots: false
                    });


                    // Tampilkan daftar oleh-oleh di Kota Semarang
                    const olehOlehList = document.getElementById("oleh-oleh-list");
                    olehOlehList.innerHTML = "";

                    data.forEach(wisata => {
                        const wisataItem = document.createElement("div");
                        wisataItem.classList.add("col-lg-3", "col-sm-6", "mb-4");

                        wisataItem.innerHTML = `
                            <div class="item">
                                <div class="thumb">
                                    <img src="http://localhost:5000/${wisata.foto}" alt="${wisata.nama_tempat}">
                                    <div class="hover-effect">
                                        <div class="content">
                                            <div class="live">
                                                <i class="favorite-icon fa-regular fa-heart" data-id="${wisata.id}" onclick="toggleFavorite(this)"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="down-content">
                                    <h4>${wisata.nama_tempat}</h4>
                                    
                                    <p><strong>Rating:</strong> ${wisata.rating} ⭐</p>
                                </div>
                            </div>
                        `;

                        olehOlehList.appendChild(wisataItem);
                    });
                })
                .catch(error => console.error("Gagal mengambil data wisata:", error));
        });

// Fungsi untuk mengambil data objek wisata kategori Kota Lama dan menampilkannya di Owl Carousel
function loadTopRatedKotaLama() {
    fetch("http://localhost:5000/api/wisata/top/oleh%20oleh")  // Endpoint untuk mengambil data Kota Lama
        .then(response => response.json())
        .then(data => {
            console.log("Data Top Rated Kota Lama:", data);  // Debugging untuk melihat data yang diterima

            if (!Array.isArray(data)) {
                console.error("Data yang diterima bukan array:", data);
                return;
            }

            // Pilih elemen carousel
            let owlCarousel = document.querySelector('#oleh-oleh-carousel');
            owlCarousel.innerHTML = '';  // Clear carousel sebelum menambah data baru

            // Masukkan data Kota Lama ke dalam carousel
            data.forEach(item => {
                const wisataCard = `
                    <div class="item">
                        <img src="http://localhost:5000/${item.foto}" alt="${item.nama_tempat}">
                        <h5>${item.nama_tempat}</h5>
                        <p>Rating: ${item.averageRating}</p>
                    </div>
                `;
                owlCarousel.innerHTML += wisataCard;
            });

            // Setelah data ditambahkan, inisialisasi Owl Carousel
            $('#oleh-oleh-carousel').owlCarousel({
                items: 3,  // Menampilkan 3 item per halaman
                loop: true,
                autoplay: true,
                autoplayTimeout: 3000,
                autoplayHoverPause: true,
                margin: 20,  // Jarak antar item
                nav: true,   // Tombol navigasi aktif
                dots: false, // Nonaktifkan dots
            });
        })
        .catch(error => console.error("Gagal memuat data top rated Kota Lama:", error));
}

// Memanggil fungsi saat halaman dimuat
document.addEventListener("DOMContentLoaded", loadTopRatedKotaLama);


        // Fungsi untuk toggle favorit
function toggleFavorite(icon) {
    const token = localStorage.getItem('token');  // Ambil token dari localStorage
    if (!token) {
        alert('Silakan login terlebih dahulu untuk menambahkan ke favorit!');
        return;
    }

    const wisataId = icon.getAttribute('data-id');  // Ambil ID wisata
    const userId = JSON.parse(atob(token.split('.')[1])).id;  // Mendekode JWT dan ambil userId

    const isFavorited = icon.classList.contains("fa-solid"); // Cek apakah sudah ada di favorit

    // Jika belum difavoritkan, tambahkan ke favorit
    if (!isFavorited) {
        fetch(`http://localhost:5000/api/favorite/${userId}/${wisataId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ userId, wisataId })
        })
        .then(response => response.json())
        .then(data => {
            // Setelah menambah, ubah ikon menjadi berwarna
            icon.classList.add("fa-solid");
            icon.classList.remove("fa-regular");
        })
        .catch(error => {
            console.error("Error adding to favorite:", error);
        });
    } else {
        // Jika sudah difavoritkan, hapus dari favorit
        fetch(`http://localhost:5000/api/favorite/${userId}/${wisataId}`, {
            method: 'DELETE',
            headers: {
                'Authorization': `Bearer ${token}`
            }
        })
        .then(response => response.json())
        .then(data => {
            // Setelah menghapus, ubah ikon menjadi abu-abu
            icon.classList.add("fa-regular");
            icon.classList.remove("fa-solid");
        })
        .catch(error => {
            console.error("Error removing from favorite:", error);
        });
    }
}


</script>



  </body>

</html>
